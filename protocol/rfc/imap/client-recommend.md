# 邮件客户端建议 
- RFC2683: IMAP4 Implementation Recommendations
- RFC4549: Synchronization Operations for Disconnected IMAP4 Clients
- RFC7162: IMAP Extensions: Quick Flag Changes Resynchronization (CONDSTORE) and Quick Mailbox Resynchronization (QRESYNC)
## TIPS
- SELECT 可能失败（服务器拒绝），避免建立过多session，部分服务器不支持多个session/单个session同时打开一个folder，这也是避免在Selected状态下，用`STATUS`获取当前Folder的状态
- 避免在已经选择了当前folder的时候，使用`STATUS`查询当前Folder，并且`STATUS`返回的信息(EXIST)跟SELECT返回的信息可能不一致，并且在部分服务器中存在#1的问题，A further note about STATUS: The STATUS command is sometimes used to check a non-selected mailbox for new mail.  This mechanism must not be used to check for new mail in the selected mailbox。
- STATUS 可以不需要选择某个文件夹，直接在未进入Folder的时候查询这个folder的状态
- SEARCH FLAG 速度很快. 查看UNSEEN不要用`STATUS`，应该使用`SEARCH UNSEEN`替代。 在我们的APP中应该禁止使用`STATUS`,因为我们不需要在当前Folder查询另外一个Folder的信息。文本搜索速度慢
- 分批下载邮件，使用`*`下载最后一批
- 一个PART也可以分批下载`022 FETCH 3 BODY[1]<0.20000>`，对于巨大的PART，如附件可以分批下。
- 当服务器不能存储UID时候，必须每次变化`UIDVALIDITY`,这样可以每次为邮件分配一个新的UID
- 很容易错误的理解为`UIDVALIDITY`+`UID`构成对邮件的ID，两个mailbox的`UIDVALIDITY`有可能相同，相当于`UIDVALIDITY`只是用来控制缓存的。It seems to be a common misunderstanding that "the UIDVALIDITY and the UID, taken together, form a 64-bit identifier that uniquely identifies a message on a server".  This is absolutely NOT TRUE.
- RFC822.SIZE有部分服务器返回的是一个估计值
- 文件夹的分隔符可以为任意字符。 `/`不是唯一。
- 文件名编码问题，特殊字符转码等
- 所有的扩展命令，都都通过`CAPABILITY`进行检测
- 三大不可控因素
  - Folder 列表过大
  - 单个part过大，比如我们下载100封邮件的plain body，每个plain part 1M，则单批下载100M
- 删除folder：部分服务器不允许删除非空folder，部分服务器不允许删除当前选中的Folder
- 服务器推送的响应我们不支持，并且也不打算支持：it MUST be able to handle any "unexpected" unsolicited responses, like EXISTS and EXPUNGE, at any time.
- 更新Flag避免使用`FLAGS`参数， 尽量使用`FLAGS.SILENT`（`.SILENT`是可以减少网络流量)
- EXPUNGE,对于部分邮箱，它会AutoExpunge，部分不会。`UID Expunge` 可以做到删除部分`\Deleted`邮件
- 下载单个邮件的part时，可以批量下载:`A013 UID fetch 11 (BODY[1.1] BODY[1.2])`
- 影响比较大的几个扩展
  - UIDPLUS
  - MULTIAPPEND
  - LITERAL+/LITERAL-
  - CONDSTORE